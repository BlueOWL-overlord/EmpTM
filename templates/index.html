<!DOCTYPE html>
<html>
<head>
    <title>EmpTM</title>
    <link rel="stylesheet" href="/static/style.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.7/joint.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/lodash.js/4.17.21/lodash.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/backbone.js/1.4.0/backbone-min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jointjs/3.7.7/joint.min.js"></script>
    <script>
        // Check if dependencies are loaded
        window.onload = function() {
            if (typeof jQuery === 'undefined') {
                console.error("jQuery not loaded");
            } else {
                console.log("jQuery loaded:", jQuery.fn.jquery);
            }
            if (typeof _ === 'undefined') {
                console.error("Lodash not loaded");
            } else {
                console.log("Lodash loaded:", _.VERSION);
            }
            if (typeof Backbone === 'undefined') {
                console.error("Backbone not loaded");
            } else {
                console.log("Backbone loaded:", Backbone.VERSION);
            }
            if (typeof joint === 'undefined') {
                console.error("JointJS not loaded. Ensure the CDN is accessible and there are no network issues.");
            } else {
                console.log("JointJS loaded:", joint.version);
                console.log("JointJS dia namespace:", joint.dia ? "Available" : "Not available");
            }
        };
    </script>
    <script src="/static/script.js"></script>
</head>
<body>
    <h1>EmpTM: Draw Your DFD</h1>
    <div class="container">
        <div id="wizard">
            <h3>Quick Start</h3>
            <p>1. Drag elements from the left to the canvas.</p>
            <p>2. Connect them with links to define flows.</p>
            <p>3. Click elements/links to set properties.</p>
            <p>4. Click "Analyze" to generate a report.</p>
            <button onclick="startWizard()">Guided Setup</button>
            <button onclick="autoAWS()">Auto-Generate from AWS</button>
        </div>
        <div id="threat-feed-config">
            <h3>Threat Feed Configuration</h3>
            <label>Feed Source:
                <select id="feed-source">
                    <option value="otx">AlienVault OTX</option>
                    <option value="virustotal">VirusTotal</option>
                    <option value="mitre">MITRE ATT&CK</option>
                    <option value="custom">Custom</option>
                </select>
            </label><br>
            <label>API Key: <input type="text" id="feed-api-key" placeholder="Enter API key if required"></label><br>
            <label id="custom-url-label" style="display:none;">Custom URL: <input type="text" id="feed-custom-url" placeholder="e.g., https://api.example.com"></label><br>
            <button onclick="saveFeedConfig()">Save Config</button>
        </div>
        <div id="stencil">
            <h3>Elements</h3>
            <div id="stencil-canvas"></div>
        </div>
        <div id="canvas">
            <div id="canvas-fallback" style="color: red; display: none;">
                Canvas failed to render. Check console for errors.
            </div>
        </div>
        <div id="properties">
            <h3>Properties</h3>
            <div id="element-props" style="display:none;">
                <label title="Enable if data is encrypted at rest or in transit">Encrypted: <input type="checkbox" id="isEncrypted"></label><br>
                <label title="Enable if authentication is required">Authenticated: <input type="checkbox" id="implementsAuthenticationScheme"></label><br>
                <label title="Enable if input is validated/sanitized">Sanitizes Input: <input type="checkbox" id="sanitizesInput"></label><br>
                <label id="public-label" style="display:none;" title="Enable if publicly accessible">Public: <input type="checkbox" id="isPublic"></label>
            </div>
            <div id="flow-props" style="display:none;">
                <label title="Enable if flow uses encryption (e.g., TLS)">Encrypted: <input type="checkbox" id="flowIsEncrypted"></label><br>
                <label title="Specify the protocol (e.g., HTTP, HTTPS)">Protocol: <input type="text" id="protocol" value="HTTP"></label>
            </div>
        </div>
    </div>
    <button onclick="analyze()">Analyze</button>
</body>
</html>
